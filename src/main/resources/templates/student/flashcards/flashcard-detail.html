<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Flashcard Detail | Student</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" />
  <style>
    .flashcard {
      min-height: 200px;
      cursor: pointer;
      transition: transform 0.3s;
    }

    .flashcard:hover {
      transform: scale(1.02);
    }

    .flashcard-content {
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 180px;
    }
  </style>
</head>

<body>
  <div class="container py-4">
    <a href="/student/flashcards" class="btn btn-link">‚Üê Back to library</a>
    <h3 class="mb-4">Flashcard Detail</h3>
    <div class="row g-4">
      <div class="col-12 col-lg-6">
        <div class="card flashcard" id="flashcard" onclick="flip()">
          <div class="card-body flashcard-content">
            <div class="text-center">
              <h4 id="cardText">Loading...</h4>
              <div id="cardPronunciation" class="text-muted small mt-2"></div>
              <div id="cardImage" class="mt-3"></div>
            </div>
          </div>
          <div class="card-footer text-center">
            <small class="text-muted">Click to flip</small>
          </div>
        </div>
      </div>
      <div class="col-12 col-lg-6">
        <div class="card">
          <div class="card-header">
            <h5>Details</h5>
          </div>
          <div class="card-body">
            <div class="mb-3">
              <strong>Difficulty:</strong> <span id="difficulty" class="badge"></span>
            </div>
            <div class="mb-3">
              <strong>Course:</strong> <span id="course">-</span>
            </div>
            <div class="mb-3">
              <strong>Tags:</strong> <span id="tags">-</span>
            </div>
            <div class="mb-3">
              <strong>Example:</strong>
              <div id="example" class="mt-1 p-2 bg-light rounded">-</div>
            </div>
            <div class="mb-3">
              <strong>Note:</strong>
              <div id="note" class="mt-1 p-2 bg-light rounded">-</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <script th:inline="javascript">
    const flashcardId = /*[[${flashcardId}]]*/ 0;
    let flashcardData = null;
    let isFlipped = false;

    async function loadFlashcard() {
      const res = await fetch(`/api/flashcards/${flashcardId}`, { credentials: 'include' });
      const json = await res.json();
      if (!json.success) return;
      flashcardData = json.data;

      document.getElementById('difficulty').textContent = flashcardData.difficulty || '';
      document.getElementById('difficulty').className = 'badge ' + difficultyBadge(flashcardData.difficulty);
      document.getElementById('course').textContent = flashcardData.courseName || 'Personal';
      document.getElementById('tags').textContent = flashcardData.tags || '-';
      document.getElementById('example').textContent = flashcardData.exampleSentence || '-';
      document.getElementById('note').textContent = flashcardData.note || '-';

      showFront();
    }

    function showFront() {
      document.getElementById('cardText').textContent = flashcardData.frontText || '';
      document.getElementById('cardPronunciation').textContent = flashcardData.pronunciation || '';
      const img = document.getElementById('cardImage');
      if (flashcardData.frontImageUrl) {
        img.innerHTML = `<img src="${flashcardData.frontImageUrl}" class="img-fluid" style="max-height:100px" alt="Front image">`;
      } else {
        img.innerHTML = '';
      }
      isFlipped = false;
    }

    function showBack() {
      document.getElementById('cardText').textContent = flashcardData.backText || '';
      document.getElementById('cardPronunciation').textContent = '';
      const img = document.getElementById('cardImage');
      if (flashcardData.backImageUrl) {
        img.innerHTML = `<img src="${flashcardData.backImageUrl}" class="img-fluid" style="max-height:100px" alt="Back image">`;
      } else {
        img.innerHTML = '';
      }
      isFlipped = true;
    }

    function flip() {
      if (!flashcardData) return;
      if (isFlipped) showFront(); else showBack();
    }

    function difficultyBadge(difficulty) {
      switch ((difficulty || '').toUpperCase()) {
        case 'EASY': return 'text-bg-success';
        case 'MEDIUM': return 'text-bg-warning';
        case 'HARD': return 'text-bg-danger';
        default: return 'text-bg-secondary';
      }
    }

    document.addEventListener('DOMContentLoaded', loadFlashcard);
  </script>
</body>

</html>