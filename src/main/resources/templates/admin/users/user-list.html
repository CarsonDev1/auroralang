<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
  <title>Users | AuroraLang Admin</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <style>
    .sidebar {
      min-height: 100vh;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }

    .sidebar .nav-link {
      color: rgba(255, 255, 255, 0.8);
      padding: 0.75rem 1rem;
      margin: 0.25rem 0;
      border-radius: 0.5rem;
      transition: all 0.3s;
    }

    .sidebar .nav-link:hover,
    .sidebar .nav-link.active {
      color: white;
      background-color: rgba(255, 255, 255, 0.1);
    }

    .main-content {
      background-color: #f8f9fa;
    }

    .stat-badge {
      font-weight: 600;
    }
  </style>
</head>

<body>
  <div class="container-fluid">
    <div class="row">
      <!-- Sidebar -->
      <nav class="col-md-3 col-lg-2 d-md-block sidebar collapse">
        <div class="position-sticky pt-3">
          <div class="text-center mb-4">
            <h4 class="text-white">AuroraLang</h4>
            <p class="text-white-50 mb-0">Admin Portal</p>
          </div>
          <ul class="nav flex-column">
            <li class="nav-item">
              <a class="nav-link" href="/admin/dashboard">
                <i class="fas fa-tachometer-alt me-2"></i> Dashboard </a>
            </li>
            <li class="nav-item">
              <a class="nav-link active" href="/admin/users/user-list">
                <i class="fas fa-users me-2"></i> Users </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/admin/courses/course-list">
                <i class="fas fa-book me-2"></i> Courses </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/admin/settings/system-settings">
                <i class="fas fa-cog me-2"></i> Settings </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/admin/analytics/overview">
                <i class="fas fa-chart-bar me-2"></i> Analytics </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/auth/logout">
                <i class="fas fa-sign-out-alt me-2"></i> Logout </a>
            </li>
          </ul>
        </div>
      </nav>
      <!-- Main content -->
      <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4 py-4 main-content">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h2 class="mb-0"><i class="fas fa-users me-2 text-primary"></i>Users</h2>
          <div class="d-flex gap-2">
            <a class="btn btn-primary" href="/admin/users/new"><i class="fas fa-user-plus me-1"></i>New User</a>
            <input id="q" class="form-control" placeholder="Search name/email/username" style="min-width:260px" />
            <button class="btn btn-outline-secondary" onclick="load(0)">Search</button>
          </div>
        </div>
        <table class="table table-hover align-middle">
          <thead class="table-light">
            <tr>
              <th>ID</th>
              <th>Username</th>
              <th>Email</th>
              <th>Full name</th>
              <th>Status</th>
              <th>Created</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="tbody"></tbody>
        </table>
        <nav>
          <ul class="pagination justify-content-center" id="pager"></ul>
        </nav>
    </div>
    <script>
      async function load(page = 0) {
        const q = document.getElementById('q').value.trim();
        const url = new URL('/api/admin/users', window.location.origin);
        url.searchParams.set('page', page);
        url.searchParams.set('size', 10);
        if (q) url.searchParams.set('q', q);
        const res = await fetch(url);
        const json = await res.json();
        if (!json.success) { alert(json.message || 'Load failed'); return; }
        const p = json.data;
        document.getElementById('tbody').innerHTML = p.content.map(u => `
      <tr>
        <td>${u.userId}</td>
        <td>${u.username}</td>
        <td>${u.email}</td>
        <td>${u.fullName || ''}</td>
        <td>${u.isActive ? '<span class="badge bg-success">Active</span>' : '<span class="badge bg-secondary">Inactive</span>'}</td>
        <td>${(u.createdAt || '').toString().replace('T', ' ').substring(0, 19)}</td>
        <td>
          <a class="btn btn-sm btn-outline-primary" href="/admin/users/${u.userId}">View</a>
          <button class="btn btn-sm ${u.isActive ? 'btn-warning' : 'btn-success'}" onclick="toggle(${u.userId}, ${!u.isActive})">${u.isActive ? 'Deactivate' : 'Activate'}</button>
        </td>
      </tr>`).join('');
        renderPager(p);
      }
      function renderPager(p) {
        const ul = document.getElementById('pager');
        ul.innerHTML = '';
        for (let i = 0; i < p.totalPages; i++) {
          const li = document.createElement('li');
          li.className = 'page-item' + (i === p.page ? ' active' : '');
          li.innerHTML = `<a class="page-link" href="#">${i + 1}</a>`;
          li.addEventListener('click', (e) => { e.preventDefault(); load(i) });
          ul.appendChild(li);
        }
      }
      async function toggle(id, active) {
        await fetch(`/api/admin/users/${id}/${active ? 'activate' : 'deactivate'}`, { method: 'PATCH' });
        load(0);
      }
      load();
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>