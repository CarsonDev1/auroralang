<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>My Schedule - AuroraLang</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <style>
    .sidebar {
      min-height: 100vh;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }

    .sidebar .nav-link {
      color: rgba(255, 255, 255, 0.8);
      padding: 0.75rem 1rem;
      margin: 0.25rem 0;
      border-radius: 0.5rem;
      transition: all 0.3s;
    }

    .sidebar .nav-link:hover,
    .sidebar .nav-link.active {
      color: white;
      background-color: rgba(255, 255, 255, 0.1);
    }

    .main-content {
      background-color: #f8f9fa;
    }

    .card {
      border: none;
      border-radius: 15px;
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
    }

    .btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border: none;
    }

    .btn-primary:hover {
      background: linear-gradient(135deg, #5a67d8 0%, #6b46c1 100%);
    }

    .calendar-day {
      min-height: 120px;
      border: 1px solid #e9ecef;
      position: relative;
    }

    .calendar-day.today {
      background-color: rgba(102, 126, 234, 0.1);
    }

    .event {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 0.25rem 0.5rem;
      margin: 0.125rem 0;
      border-radius: 0.25rem;
      font-size: 0.75rem;
      cursor: pointer;
    }

    .event:hover {
      opacity: 0.8;
    }

    .time-slot {
      border-bottom: 1px solid #e9ecef;
      padding: 0.5rem;
      min-height: 60px;
    }

    .time-label {
      font-weight: bold;
      color: #6c757d;
      width: 80px;
    }
  </style>
</head>

<body>
  <div class="container-fluid">
    <div class="row">
      <!-- Sidebar -->
      <nav class="col-md-3 col-lg-2 d-md-block sidebar collapse">
        <div class="position-sticky pt-3">
          <div class="text-center mb-4">
            <h4 class="text-white">AuroraLang</h4>
            <p class="text-white-50 mb-0">Student Portal</p>
          </div>
          <ul class="nav flex-column">
            <li class="nav-item">
              <a class="nav-link" href="/student/dashboard">
                <i class="fas fa-tachometer-alt me-2"></i> Dashboard </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/student/courses">
                <i class="fas fa-book me-2"></i> My Courses </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/student/classes">
                <i class="fas fa-chalkboard-teacher me-2"></i> My Classes </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/student/flashcards">
                <i class="fas fa-layer-group me-2"></i> Flashcards </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/student/lessons">
                <i class="fas fa-play-circle me-2"></i> Lessons </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/student/tests">
                <i class="fas fa-clipboard-check me-2"></i> Tests </a>
            </li>
            <li class="nav-item">
              <a class="nav-link active" href="/student/schedule">
                <i class="fas fa-calendar-alt me-2"></i> Schedule </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/auth/logout">
                <i class="fas fa-sign-out-alt me-2"></i> Logout </a>
            </li>
          </ul>
        </div>
      </nav>
      <!-- Main content -->
      <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4 main-content">
        <div
          class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
          <h1 class="h2">My Schedule</h1>
          <div class="btn-toolbar mb-2 mb-md-0">
            <div class="btn-group me-2">
              <button type="button" class="btn btn-outline-primary" onclick="showWeekView()">
                <i class="fas fa-calendar-week me-1"></i> Week </button>
              <button type="button" class="btn btn-primary" onclick="showDayView()">
                <i class="fas fa-calendar-day me-1"></i> Day </button>
            </div>
          </div>
        </div>
        <!-- Calendar Navigation -->
        <div class="row mb-3">
          <div class="col-md-6">
            <div class="d-flex align-items-center">
              <button class="btn btn-outline-secondary me-2" onclick="previousWeek()">
                <i class="fas fa-chevron-left"></i>
              </button>
              <h4 class="mb-0" id="currentWeek">October 29 - November 4, 2025</h4>
              <button class="btn btn-outline-secondary ms-2" onclick="nextWeek()">
                <i class="fas fa-chevron-right"></i>
              </button>
            </div>
          </div>
          <div class="col-md-6 text-end">
            <button class="btn btn-outline-primary" onclick="goToToday()">
              <i class="fas fa-calendar-check me-1"></i> Today </button>
          </div>
        </div>
        <!-- Week View -->
        <div id="weekView" class="card">
          <div class="card-body">
            <!-- Week Header -->
            <div class="row mb-2">
              <div class="col-1"></div> <!-- Time column -->
              <div class="col text-center"><strong>Monday</strong><br><small>Oct 29</small></div>
              <div class="col text-center"><strong>Tuesday</strong><br><small>Oct 30</small></div>
              <div class="col text-center"><strong>Wednesday</strong><br><small>Oct 31</small></div>
              <div class="col text-center"><strong>Thursday</strong><br><small>Nov 1</small></div>
              <div class="col text-center"><strong>Friday</strong><br><small>Nov 2</small></div>
              <div class="col text-center"><strong>Saturday</strong><br><small>Nov 3</small></div>
              <div class="col text-center"><strong>Sunday</strong><br><small>Nov 4</small></div>
            </div>
            <!-- Time Slots -->
            <div class="schedule-grid">
              <!-- 8:00 AM -->
              <div class="row time-slot">
                <div class="col-1 time-label">8:00 AM</div>
                <div class="col"></div>
                <div class="col"></div>
                <div class="col">
                  <div class="event" onclick="showEventDetail('JavaScript Advanced')"> JavaScript Advanced<br>
                    <small>Room A101</small>
                  </div>
                </div>
                <div class="col"></div>
                <div class="col">
                  <div class="event" onclick="showEventDetail('Node.js Basics')"> Node.js Basics<br>
                    <small>Room B202</small>
                  </div>
                </div>
                <div class="col"></div>
                <div class="col"></div>
              </div>
              <!-- 9:00 AM -->
              <div class="row time-slot">
                <div class="col-1 time-label">9:00 AM</div>
                <div class="col">
                  <div class="event" onclick="showEventDetail('React Fundamentals')"> React Fundamentals<br>
                    <small>Room C303</small>
                  </div>
                </div>
                <div class="col"></div>
                <div class="col"></div>
                <div class="col"></div>
                <div class="col"></div>
                <div class="col"></div>
                <div class="col"></div>
              </div>
              <!-- 10:00 AM -->
              <div class="row time-slot">
                <div class="col-1 time-label">10:00 AM</div>
                <div class="col"></div>
                <div class="col"></div>
                <div class="col"></div>
                <div class="col"></div>
                <div class="col"></div>
                <div class="col"></div>
                <div class="col"></div>
              </div>
              <!-- 11:00 AM -->
              <div class="row time-slot">
                <div class="col-1 time-label">11:00 AM</div>
                <div class="col"></div>
                <div class="col"></div>
                <div class="col"></div>
                <div class="col"></div>
                <div class="col"></div>
                <div class="col"></div>
                <div class="col"></div>
              </div>
              <!-- 2:00 PM -->
              <div class="row time-slot">
                <div class="col-1 time-label">2:00 PM</div>
                <div class="col"></div>
                <div class="col"></div>
                <div class="col">
                  <div class="event" onclick="showEventDetail('Database Design')"> Database Design<br>
                    <small>Room D404</small>
                  </div>
                </div>
                <div class="col"></div>
                <div class="col"></div>
                <div class="col"></div>
                <div class="col"></div>
              </div>
              <!-- 3:00 PM -->
              <div class="row time-slot">
                <div class="col-1 time-label">3:00 PM</div>
                <div class="col"></div>
                <div class="col"></div>
                <div class="col"></div>
                <div class="col"></div>
                <div class="col"></div>
                <div class="col"></div>
                <div class="col"></div>
              </div>
            </div>
          </div>
        </div>
        <!-- Upcoming Events -->
        <div class="row mt-4">
          <div class="col-md-6">
            <div class="card">
              <div class="card-header">
                <h5 class="mb-0">
                  <i class="fas fa-clock me-2"></i> Upcoming Classes
                </h5>
              </div>
              <div class="card-body">
                <div class="list-group list-group-flush">
                  <div class="list-group-item d-flex justify-content-between align-items-start">
                    <div class="ms-2 me-auto">
                      <div class="fw-bold">JavaScript Advanced</div>
                      <small>Tomorrow, 8:00 AM - 10:00 AM</small>
                    </div>
                    <span class="badge bg-primary rounded-pill">Room A101</span>
                  </div>
                  <div class="list-group-item d-flex justify-content-between align-items-start">
                    <div class="ms-2 me-auto">
                      <div class="fw-bold">React Fundamentals</div>
                      <small>Monday, 9:00 AM - 11:00 AM</small>
                    </div>
                    <span class="badge bg-success rounded-pill">Room C303</span>
                  </div>
                  <div class="list-group-item d-flex justify-content-between align-items-start">
                    <div class="ms-2 me-auto">
                      <div class="fw-bold">Database Design</div>
                      <small>Wednesday, 2:00 PM - 4:00 PM</small>
                    </div>
                    <span class="badge bg-warning rounded-pill">Room D404</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-md-6">
            <div class="card">
              <div class="card-header">
                <h5 class="mb-0">
                  <i class="fas fa-clipboard-check me-2"></i> Upcoming Tests
                </h5>
              </div>
              <div class="card-body">
                <div class="list-group list-group-flush">
                  <div class="list-group-item d-flex justify-content-between align-items-start">
                    <div class="ms-2 me-auto">
                      <div class="fw-bold">JavaScript Quiz</div>
                      <small>Friday, 10:00 AM</small>
                    </div>
                    <span class="badge bg-danger rounded-pill">30 min</span>
                  </div>
                  <div class="list-group-item d-flex justify-content-between align-items-start">
                    <div class="ms-2 me-auto">
                      <div class="fw-bold">React Final Test</div>
                      <small>Next Monday, 2:00 PM</small>
                    </div>
                    <span class="badge bg-warning rounded-pill">60 min</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </main>
    </div>
  </div>
  <!-- Event Detail Modal -->
  <div class="modal fade" id="eventModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="eventTitle">Event Details</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body" id="eventDetails">
          <!-- Event details will be populated here -->
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <button type="button" class="btn btn-primary">Join Class</button>
        </div>
      </div>
    </div>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    let currentDate = new Date();
    let viewMode = 'week';

    document.addEventListener('DOMContentLoaded', function () {
      updateCalendarHeader();
    });

    function showWeekView() {
      viewMode = 'week';
      document.getElementById('weekView').style.display = 'block';
      // Update button states
      document.querySelector('[onclick="showWeekView()"]').classList.add('btn-primary');
      document.querySelector('[onclick="showWeekView()"]').classList.remove('btn-outline-primary');
      document.querySelector('[onclick="showDayView()"]').classList.add('btn-outline-primary');
      document.querySelector('[onclick="showDayView()"]').classList.remove('btn-primary');
    }

    function showDayView() {
      viewMode = 'day';
      // For now, just show week view (day view would need separate implementation)
      alert('Day view coming soon!');
    }

    function previousWeek() {
      currentDate.setDate(currentDate.getDate() - 7);
      updateCalendarHeader();
    }

    function nextWeek() {
      currentDate.setDate(currentDate.getDate() + 7);
      updateCalendarHeader();
    }

    function goToToday() {
      currentDate = new Date();
      updateCalendarHeader();
    }

    function updateCalendarHeader() {
      const startOfWeek = new Date(currentDate);
      startOfWeek.setDate(currentDate.getDate() - currentDate.getDay() + 1); // Monday

      const endOfWeek = new Date(startOfWeek);
      endOfWeek.setDate(startOfWeek.getDate() + 6); // Sunday

      const options = { month: 'long', day: 'numeric' };
      const startStr = startOfWeek.toLocaleDateString('en-US', options);
      const endStr = endOfWeek.toLocaleDateString('en-US', options);
      const year = currentDate.getFullYear();

      document.getElementById('currentWeek').textContent = `${startStr} - ${endStr}, ${year}`;
    }

    function showEventDetail(sessionId) {
      const modal = new bootstrap.Modal(document.getElementById('eventModal'));

      // Load session details from API
      fetch(`/api/dashboard/schedule/session/${sessionId}`, {
        method: 'GET',
        credentials: 'include'
      })
        .then(response => {
          if (!response.ok) {
            throw new Error('Failed to load session details');
          }
          return response.json();
        })
        .then(result => {
          const details = result.data;
          document.getElementById('eventTitle').textContent = details.sessionName || 'Session Details';

          const timeDisplay = details.time || 'TBD';
          const roomDisplay = details.room || 'TBD';
          const teacherDisplay = details.teacher || 'TBD';
          const descriptionDisplay = details.description || 'No description available';

          document.getElementById('eventDetails').innerHTML = `
          <p><strong>Time:</strong> ${timeDisplay}</p>
          <p><strong>Room:</strong> ${roomDisplay}</p>
          <p><strong>Teacher:</strong> ${teacherDisplay}</p>
          <p><strong>Date:</strong> ${details.date || 'TBD'}</p>
          <p><strong>Description:</strong> ${descriptionDisplay}</p>
          ${details.onlineMeetingUrl ? `<p><strong>Online Meeting:</strong> <a href="${details.onlineMeetingUrl}" target="_blank">Join Meeting</a></p>` : ''}
        `;

          modal.show();
        })
        .catch(error => {
          console.error('Error loading session details:', error);
          document.getElementById('eventTitle').textContent = 'Error';
          document.getElementById('eventDetails').innerHTML = `
          <p class="text-danger">Failed to load session details. Please try again later.</p>
        `;
          modal.show();
        });
    }
  </script>
</body>

</html>